(function(e){function t(t){for(var i,o,l=t[0],c=t[1],u=t[2],d=0,p=[];d<l.length;d++)o=l[d],n[o]&&p.push(n[o][0]),n[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);s&&s(t);while(p.length)p.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,l=1;l<a.length;l++){var c=a[l];0!==n[c]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=a[0]))}return e}var i={},n={app:0},r=[];function o(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=i,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var s=c;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var i=a("1356"),n=a.n(i);n.a},1356:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var i=a("2b0e"),n=a("ce5b"),r=a.n(n),o=(a("bf40"),a("3ccf")),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",{staticStyle:{height:"100%"}},[a("v-toolbar",{attrs:{app:"",dark:"",color:"#222831",dense:""}},[a("v-toolbar-title",{staticClass:"headline"},[a("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"http://www.cemfi.de/",target:"_blank"}},[a("span",{staticStyle:{color:"#f96d00"}},[e._v("cemfi.")])]),a("span",{staticClass:"font-weight-thin"},[e._v("ScoreTube")])]),a("v-toolbar-items",[a("v-tabs",{directives:[{name:"show",rawName:"v-show",value:null==e.alignment,expression:"alignment==null"}],staticStyle:{"margin-left":"20px"},attrs:{color:"#222831",dark:"","slider-color":"#f96d00"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("v-tab",[a("img",{staticStyle:{width:"22px",height:"22px","margin-right":"5px"},attrs:{src:e.publicPath+"icons/youtube.svg"}}),e._v("\n          YouTube\n        ")]),a("v-tab",[a("img",{staticStyle:{width:"22px",height:"22px","margin-right":"5px"},attrs:{src:e.publicPath+"icons/audio.svg"}}),e._v("\n          Audio\n        ")])],1)],1),a("v-spacer"),e._v("\n    v"+e._s(e.version)+"\n  ")],1),a("v-content",[a("div",{directives:[{name:"show",rawName:"v-show",value:null==e.alignment,expression:"alignment==null"}]},[a("input",{ref:"meiFile",staticStyle:{display:"none"},attrs:{type:"file",accept:".mei, .xml"},on:{change:e.onMeiFilePicked}}),a("input",{ref:"audioFile",staticStyle:{display:"none"},attrs:{type:"file",accept:".mp3, .wav, *.wave"},on:{change:e.onAudioFilePicked}}),0==e.activeTab?a("div",{staticClass:"centered",staticStyle:{height:"100%"}},[a("v-card",{staticClass:"pa-3 centered"},[a("v-text-field",{staticStyle:{width:"300px"},attrs:{color:"accent",label:"MEI file",readonly:""},on:{click:e.pickMei},model:{value:e.meiFile.name,callback:function(t){e.$set(e.meiFile,"name",t)},expression:"meiFile.name"}}),a("v-text-field",{staticStyle:{width:"300px"},attrs:{color:"accent",label:"YouTube URL"},model:{value:e.youtubeUrl,callback:function(t){e.youtubeUrl=t},expression:"youtubeUrl"}}),a("v-btn",{attrs:{color:"accent",loading:e.loading,disabled:e.loading},on:{click:e.processYoutube}},[e._v("Start")])],1)],1):1==e.activeTab?a("div",{staticClass:"centered",staticStyle:{height:"100%"}},[a("v-card",{staticClass:"pa-3 centered"},[a("v-text-field",{staticStyle:{width:"300px"},attrs:{color:"accent",label:"MEI file",readonly:""},on:{click:e.pickMei},model:{value:e.meiFile.name,callback:function(t){e.$set(e.meiFile,"name",t)},expression:"meiFile.name"}}),a("v-text-field",{staticStyle:{width:"300px"},attrs:{color:"accent",label:"Audio file",readonly:""},on:{click:e.pickAudio},model:{value:e.audioFile.name,callback:function(t){e.$set(e.audioFile,"name",t)},expression:"audioFile.name"}}),a("v-btn",{attrs:{color:"accent",loading:e.loading,disabled:e.loading},on:{click:e.processAudio}},[e._v("Start")])],1)],1):e._e()]),a("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.alignment,expression:"alignment!=null"}],staticStyle:{"padding-top":"20px"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.youtubePlayer,expression:"youtubePlayer!=null"}],staticStyle:{"text-align":"center","background-color":"#000000",width:"100%"}},[a("div",{staticClass:".text-center",attrs:{id:"youtube"}})]),a("div",{ref:"meiSvg",staticStyle:{cursor:"crosshair","overflow-x":"scroll","overflow-y":"auto"},attrs:{id:"meiSvg"}}),a("audio",{directives:[{name:"show",rawName:"v-show",value:""!=e.audioFile.name,expression:"audioFile.name!=''"}],ref:"audio",staticStyle:{width:"100%"},attrs:{controls:""}})])])],1)},c=[],u=(a("6b54"),a("456d"),a("ac6a"),a("7f7f"),a("bc3a")),s=a.n(u),d=a("1157"),p=a.n(d),m=a("5698"),f=a("9fab"),v=a.n(f),h=a("9224");function y(e){var t,a,i=0,n=this.length-1;while(i<=n)if(t=(i+n)/2|0,a=this[t],a<e)i=t+1;else{if(!(a>e))return t;n=t-1}return[n,i]}function b(e,t,a,i,n){return(e-t)*(n-i)/(a-t)+i}var g={binaryIndexOf:y,map:b};s.a.defaults.timeout=18e4;var x={name:"App",components:{},data:function(){return{publicPath:"",version:h["a"],activeTab:0,youtubeUrl:null,meiFile:{name:""},audioFile:{name:""},svgData:"",meiData:"",pixelToTime:{},timeToPixel:{},cursor:null,verovio:new verovio.toolkit,alignment:null,loading:!1,youtubePlayer:null,audioPlayer:null}},mounted:function(){this.verovio.setOptions({scale:30,breaks:"none",font:"Bravura"})},methods:{pickMei:function(){this.$refs.meiFile.click()},pickAudio:function(){this.$refs.audioFile.click()},onMeiFilePicked:function(e){this.meiFile=e.target.files[0]},onAudioFilePicked:function(e){this.audioFile=e.target.files[0]},processYoutube:function(){var e=this;if(""!==this.meiFile.name&&""!==this.youtubeUrl){this.loading=!0;var t=new FormData,a=-1===this.youtubeUrl.indexOf("://")?"http://".concat(this.youtubeUrl):this.youtubeUrl;t.append("mei",this.meiFile),t.append("youtube-url",a),s.a.post("http://localhost:8001/youtube",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.alignment=t.data,e.youtubePlayer=new YT.Player("youtube",{height:"390",width:"640",videoId:v()(e.youtubeUrl)}),p()(document).on("keypress",function(t){32===t.which&&(1!==e.youtubePlayer.getPlayerState()?e.youtubePlayer.playVideo():e.youtubePlayer.pauseVideo())});var a=m["c"]("#meiSvg"),i=new FileReader,n=e;i.onload=function(){e.meiData=i.result,e.svgData=e.verovio.renderData(e.meiData,{}),e.$refs.meiSvg.innerHTML=e.svgData,m["c"](".page-margin").append("line").attr("id","cursor").attr("x1",-10).attr("x2",-10).attr("y1",0).attr("y2","100%").attr("stroke-width",75).attr("stroke","#f96d00"),e.cursor=m["c"]("#cursor"),m["c"](".system").append("rect").attr("id","click-area").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","#000000").attr("opacity",0),m["c"]("#click-area").on("click",function(){n.youtubePlayer.seekTo(n.getTimeFromPixel(m["b"](m["a"].currentTarget)[0]),!0)}),Object.keys(e.alignment).forEach(function(t){var i=a.select("#".concat(t)).node().getBBox(),n=i.x;e.pixelToTime[n.toString()]=e.alignment[t],e.timeToPixel[e.alignment[t].toString()]=n}),setInterval(function(){e.updateCursor(e.youtubePlayer.getCurrentTime())},20)},i.readAsText(e.meiFile)}).catch(function(e){console.log(e)})}},processAudio:function(){var e=this;if(""!==this.meiFile.name&&""!==this.audioFile.name){this.loading=!0;var t=new FormData;t.append("mei",this.meiFile),t.append("audio",this.audioFile),s.a.post("http://localhost:8001/audio",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.alignment=t.data,e.audioPlayer=e.$refs.audio,e.audioPlayer.src=URL.createObjectURL(e.audioFile),p()(document).on("keypress",function(t){32===t.which&&(e.audioPlayer.paused?e.audioPlayer.play():e.audioPlayer.pause())});var a=m["c"]("#meiSvg"),i=new FileReader,n=e;i.onload=function(){e.meiData=i.result,e.svgData=e.verovio.renderData(e.meiData,{}),e.$refs.meiSvg.innerHTML=e.svgData,m["c"](".page-margin").append("line").attr("id","cursor").attr("x1",-10).attr("x2",-10).attr("y1",0).attr("y2","100%").attr("stroke-width",75).attr("stroke","#f96d00"),e.cursor=m["c"]("#cursor"),m["c"](".system").append("rect").attr("id","click-area").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","#000000").attr("opacity",0),m["c"]("#click-area").on("click",function(){n.audioPlayer.currentTime=n.getTimeFromPixel(m["b"](m["a"].currentTarget)[0])}),Object.keys(e.alignment).forEach(function(t){var i=a.select("#".concat(t)).node().getBBox(),n=i.x;e.pixelToTime[n.toString()]=e.alignment[t],e.timeToPixel[e.alignment[t].toString()]=n}),setInterval(function(){e.updateCursor(e.audioPlayer.currentTime)},20)},i.readAsText(e.meiFile)}).catch(function(e){console.log(e)})}},updateCursor:function(e){var t=this.getPixelFromTime(e);isNaN(t)?this.cursor.attr("opacity",0):(this.cursor.attr("opacity",1),this.cursor.attr("x1",t),this.cursor.attr("x2",t))},getTimeFromPixel:function(e){var t=this.pixelToTime,a=p.a.map(t,function(e,t){return t}),i=g.binaryIndexOf.call(a,e),n=a[i[0]],r=a[i[1]],o=t[n],l=t[r],c=0;return null!==n&&(c=g.map(e,n,r,o,l)),c},getPixelFromTime:function(e){var t=this.timeToPixel,a=p.a.map(t,function(e,t){return t}),i=g.binaryIndexOf.call(a,e),n=a[i[0]],r=a[i[1]],o=t[n],l=t[r];return g.map(e,n,r,o,l)}}},w=x,T=(a("034f"),a("2877")),k=a("6544"),F=a.n(k),P=a("7496"),S=a("8336"),O=a("b0af"),_=a("549c"),C=a("9910"),D=a("71a3"),M=a("fe57"),V=a("2677"),j=a("71d9"),A=a("2a7f"),U=Object(T["a"])(w,l,c,!1,null,null,null),$=U.exports;F()(U,{VApp:P["a"],VBtn:S["a"],VCard:O["a"],VContent:_["a"],VSpacer:C["a"],VTab:D["a"],VTabs:M["a"],VTextField:V["a"],VToolbar:j["a"],VToolbarItems:A["a"],VToolbarTitle:A["b"]}),i["default"].config.productionTip=!1,i["default"].use(r.a,{theme:{primary:"#222831",accent:"#f96d00"}}),new i["default"]({render:function(e){return e($)},directives:{Ripple:o["a"]}}).$mount("#app")},9224:function(e){e.exports={a:"1.0.0"}}});